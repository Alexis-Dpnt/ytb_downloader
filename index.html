<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <title>Téléchargeur de Vidéo</title>
  </head>
  <body>
    <h1>Téléchargeur de Vidéo</h1>
    <p>Colle ici l'URL de la vidéo à télécharger :</p>
    <input type="text" id="url" placeholder="URL de la vidéo" />
    <p>Écris ici le nom que tu veux donner à la vidéo dans tes fichiers :</p>
    <input type="text" id="name" placeholder="Nom du fichier" /> <br />
    <br />
    <button onclick="telecharger()">Télécharger</button>

    <p id="message"></p>

    <hr />

    <h2>Vidéos Téléchargées</h2>
    <ul id="video-list">
      <!-- Les vidéos seront listées ici -->
    </ul>

    <script>
      // Fonction pour télécharger la vidéo
      function telecharger() {
        const url = document.getElementById("url").value.trim();
        const name = document.getElementById("name").value.trim();
        const message = document.getElementById("message");

        if (!url) {
          message.textContent = "Veuillez entrer une URL.";
          message.style.color = "red";
          return;
        }

        // Envoyer les données au serveur
        fetch("/download", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ url: url, name: name }),
        })
          .then((response) => response.json())
          .then((data) => {
            if (data.message) {
              message.textContent = data.message;
              message.style.color = "green";
              // Rafraîchir la liste des vidéos après un téléchargement réussi
              chargerVidéos();
            }
          })
          .catch((error) => {
            console.error("Erreur:", error);
            message.textContent = "Une erreur est survenue.";
            message.style.color = "red";
          });
      }

      // Fonction pour charger et afficher la liste des vidéos
      function chargerVidéos() {
        fetch("/list")
          .then((response) => response.json())
          .then((data) => {
            const videoList = document.getElementById("video-list");
            videoList.innerHTML = ""; // Vider la liste actuelle

            if (data.videos.length === 0) {
              videoList.innerHTML = "<li>Aucune vidéo téléchargée.</li>";
              return;
            }

            data.videos.forEach((video) => {
              const li = document.createElement("li");
              const link = document.createElement("a");
              link.href = `/videos/${encodeURIComponent(video)}`;
              link.textContent = video;
              link.target = "_blank"; // Ouvrir dans un nouvel onglet
              li.appendChild(link);
              videoList.appendChild(li);
            });
          })
          .catch((error) => {
            console.error("Erreur:", error);
          });
      }

      // Charger les vidéos au chargement de la page
      window.onload = chargerVidéos;
    </script>
  </body>
</html>
